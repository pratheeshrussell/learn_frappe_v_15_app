{
  "version": 3,
  "sources": ["../../../../../apps/frappe/frappe/public/js/frappe/form/footer/base_timeline.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/version_timeline_content_builder.js", "../../../../../apps/frappe/frappe/public/js/frappe/form/footer/form_timeline.js", "../../../../../apps/learn_frappe_v_15_app/learn_frappe_v_15_app/public/js/frappe_imports.bundle.js"],
  "sourcesContent": ["// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\n\nclass BaseTimeline {\n\tconstructor(opts) {\n\t\tObject.assign(this, opts);\n\t\tthis.make();\n\t}\n\n\tmake() {\n\t\tthis.timeline_wrapper = $(`<div class=\"new-timeline\">`);\n\t\tthis.wrapper = this.timeline_wrapper;\n\t\tthis.timeline_items_wrapper = $(`<div class=\"timeline-items\">`);\n\t\tthis.timeline_actions_wrapper = $(`\n\t\t\t<div class=\"timeline-items timeline-actions\">\n\t\t\t\t<div class=\"timeline-item\">\n\t\t\t\t\t<div class=\"timeline-content action-buttons\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`);\n\n\t\tthis.timeline_wrapper.append(this.timeline_actions_wrapper);\n\t\tthis.timeline_actions_wrapper.hide();\n\t\tthis.timeline_wrapper.append(this.timeline_items_wrapper);\n\n\t\tthis.parent.replaceWith(this.timeline_wrapper);\n\t\tthis.timeline_items = [];\n\t}\n\n\trefresh() {\n\t\tthis.render_timeline_items();\n\t}\n\n\tadd_action_button(label, action, icon = null, btn_class = null) {\n\t\tlet icon_element = icon ? frappe.utils.icon(icon, \"xs\") : null;\n\t\tthis.timeline_actions_wrapper.show();\n\t\tlet action_btn = $(`<button class=\"btn btn-xs ${btn_class || \"btn-default\"} action-btn\">\n\t\t\t${icon_element}\n\t\t\t${label}\n\t\t</button>`);\n\t\taction_btn.click(action);\n\t\tthis.timeline_actions_wrapper.find(\".action-buttons\").append(action_btn);\n\t\treturn action_btn;\n\t}\n\n\trender_timeline_items() {\n\t\tthis.timeline_items_wrapper.empty();\n\t\tthis.timeline_items = [];\n\t\tthis.doc_info = (this.frm && this.frm.get_docinfo()) || {};\n\t\tlet response = this.prepare_timeline_contents();\n\t\tif (response instanceof Promise) {\n\t\t\tresponse.then(() => {\n\t\t\t\tthis.timeline_items.sort(\n\t\t\t\t\t(item1, item2) => new Date(item2.creation) - new Date(item1.creation)\n\t\t\t\t);\n\t\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t\t});\n\t\t} else {\n\t\t\tthis.timeline_items.sort(\n\t\t\t\t(item1, item2) => new Date(item2.creation) - new Date(item1.creation)\n\t\t\t);\n\t\t\tthis.timeline_items.forEach(this.add_timeline_item.bind(this));\n\t\t}\n\t}\n\n\tprepare_timeline_contents() {\n\t\t//\n\t}\n\n\tadd_timeline_item(item, append_at_the_end = false) {\n\t\tlet timeline_item = this.get_timeline_item(item);\n\t\tif (append_at_the_end) {\n\t\t\tthis.timeline_items_wrapper.append(timeline_item);\n\t\t} else {\n\t\t\tthis.timeline_items_wrapper.prepend(timeline_item);\n\t\t}\n\t\treturn timeline_item;\n\t}\n\n\tadd_timeline_items(items, append_at_the_end = false) {\n\t\titems.forEach((item) => this.add_timeline_item(item, append_at_the_end));\n\t}\n\n\tadd_timeline_items_based_on_creation(items) {\n\t\titems.forEach((item) => {\n\t\t\tthis.timeline_items_wrapper.find(\".timeline-item\").each((i, el) => {\n\t\t\t\tlet creation = $(el).attr(\"data-timestamp\");\n\t\t\t\tif (creation && new Date(creation) < new Date(item.creation)) {\n\t\t\t\t\t$(el).before(this.get_timeline_item(item));\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tget_timeline_item(item) {\n\t\t// item can have content*, creation*,\n\t\t// timeline_badge, icon, icon_size,\n\t\t// hide_timestamp, is_card\n\t\tconst timeline_item = $(`<div class=\"timeline-item\">`);\n\n\t\tif (item.name == \"load-more\") {\n\t\t\ttimeline_item.append(\n\t\t\t\t`<div class=\"timeline-load-more\">\n\t\t\t\t\t<button class=\"btn btn-default btn-sm btn-load-more\">\n\t\t\t\t\t\t<span>${item.content}</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>`\n\t\t\t);\n\t\t\ttimeline_item.find(\".btn-load-more\").on(\"click\", async () => {\n\t\t\t\tlet more_items = await this.get_more_communication_timeline_contents();\n\t\t\t\ttimeline_item.remove();\n\t\t\t\tthis.add_timeline_items_based_on_creation(more_items);\n\t\t\t});\n\t\t\treturn timeline_item;\n\t\t}\n\n\t\ttimeline_item.attr({\n\t\t\t\"data-doctype\": item.doctype,\n\t\t\t\"data-name\": item.name,\n\t\t\t\"data-timestamp\": item.creation,\n\t\t});\n\t\tif (item.icon) {\n\t\t\ttimeline_item.append(`\n\t\t\t\t<div class=\"timeline-badge\" title='${item.title || frappe.utils.to_title_case(item.icon)}'>\n\t\t\t\t\t${frappe.utils.icon(item.icon, item.icon_size || \"md\", item.icon_class || \"\")}\n\t\t\t\t</div>\n\t\t\t`);\n\t\t} else if (item.timeline_badge) {\n\t\t\ttimeline_item.append(item.timeline_badge);\n\t\t} else {\n\t\t\ttimeline_item.append(`<div class=\"timeline-dot\">`);\n\t\t}\n\n\t\ttimeline_item.append(\n\t\t\t`<div class=\"timeline-content ${item.is_card ? \"frappe-card\" : \"\"}\">`\n\t\t);\n\t\tlet timeline_content = timeline_item.find(\".timeline-content\");\n\t\ttimeline_content.append(item.content);\n\t\tif (!item.hide_timestamp && !item.is_card) {\n\t\t\ttimeline_content.append(`<span> \u00B7 ${comment_when(item.creation)}</span>`);\n\t\t}\n\t\tif (item.id) {\n\t\t\ttimeline_content.attr(\"id\", item.id);\n\t\t}\n\n\t\treturn timeline_item;\n\t}\n}\n\nexport default BaseTimeline;\n", "// REDESIGN-TODO: Review\n\nfunction get_version_timeline_content(version_doc, frm) {\n\tif (!version_doc.data) return [];\n\tconst data = JSON.parse(version_doc.data);\n\n\t// comment\n\tif (data.comment) {\n\t\treturn [get_version_comment(version_doc, data.comment)];\n\t}\n\n\tlet out = [];\n\n\tlet updater_reference_link = null;\n\tlet updater_reference = data.updater_reference;\n\tif (!$.isEmptyObject(updater_reference)) {\n\t\tlet label = updater_reference.label || __(\"via {0}\", [updater_reference.doctype]);\n\t\tlet { doctype, docname } = updater_reference;\n\t\tif (doctype && docname) {\n\t\t\tupdater_reference_link = frappe.utils.get_form_link(doctype, docname, true, label);\n\t\t} else {\n\t\t\tupdater_reference_link = label;\n\t\t}\n\t}\n\n\t// value changed in parent\n\tif (data.changed && data.changed.length) {\n\t\tvar parts = [];\n\t\tdata.changed.every(function (p) {\n\t\t\tif (p[0] === \"docstatus\") {\n\t\t\t\tif (p[2] === 1) {\n\t\t\t\t\tlet message = updater_reference_link\n\t\t\t\t\t\t? get_user_message(\n\t\t\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"You submitted this document {0}\",\n\t\t\t\t\t\t\t\t\t[updater_reference_link],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"{0} submitted this document {1}\",\n\t\t\t\t\t\t\t\t\t[get_user_link(version_doc.owner), updater_reference_link],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: get_user_message(\n\t\t\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t\t\t__(\"You submitted this document\", null, \"Form timeline\"),\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"{0} submitted this document\",\n\t\t\t\t\t\t\t\t\t[get_user_link(version_doc.owner)],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t  );\n\n\t\t\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t\t\t} else if (p[2] === 2) {\n\t\t\t\t\tlet message = updater_reference_link\n\t\t\t\t\t\t? get_user_message(\n\t\t\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"You cancelled this document {1}\",\n\t\t\t\t\t\t\t\t\t[updater_reference_link],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"{0} cancelled this document {1}\",\n\t\t\t\t\t\t\t\t\t[get_user_link(version_doc.owner), updater_reference_link],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: get_user_message(\n\t\t\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t\t\t__(\"You cancelled this document\", null, \"Form timeline\"),\n\t\t\t\t\t\t\t\t__(\n\t\t\t\t\t\t\t\t\t\"{0} cancelled this document\",\n\t\t\t\t\t\t\t\t\t[get_user_link(version_doc.owner)],\n\t\t\t\t\t\t\t\t\t\"Form timeline\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t  );\n\n\t\t\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst df = frappe.meta.get_docfield(frm.doctype, p[0], frm.docname);\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tconst field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\tparts.push(\n\t\t\t\t\t\t\t__(\"{0} from {1} to {2}\", [\n\t\t\t\t\t\t\t\t__(df.label, null, df.parent),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[1]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[2]),\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn parts.length < 3;\n\t\t});\n\t\tif (parts.length) {\n\t\t\tlet message = updater_reference_link\n\t\t\t\t? get_user_message(\n\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t__(\"You changed the value of {0} {1}\", [\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t__(\"{0} changed the value of {1} {2}\", [\n\t\t\t\t\t\t\tget_user_link(version_doc.owner),\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t])\n\t\t\t\t  )\n\t\t\t\t: get_user_message(\n\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t__(\"You changed the value of {0}\", [parts.join(\", \")]),\n\t\t\t\t\t\t__(\"{0} changed the value of {1}\", [\n\t\t\t\t\t\t\tget_user_link(version_doc.owner),\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t])\n\t\t\t\t  );\n\n\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t}\n\t}\n\n\t// value changed in table field\n\tif (data.row_changed && data.row_changed.length) {\n\t\tlet parts = [];\n\t\tdata.row_changed.every(function (row) {\n\t\t\trow[3].every(function (p) {\n\t\t\t\tvar df =\n\t\t\t\t\tfrm.fields_dict[row[0]] &&\n\t\t\t\t\tfrappe.meta.get_docfield(\n\t\t\t\t\t\tfrm.fields_dict[row[0]].grid.doctype,\n\t\t\t\t\t\tp[0],\n\t\t\t\t\t\tfrm.docname\n\t\t\t\t\t);\n\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\tparts.push(\n\t\t\t\t\t\t\t__(\"{0} from {1} to {2} in row #{3}\", [\n\t\t\t\t\t\t\t\tfrappe.meta.get_label(frm.fields_dict[row[0]].grid.doctype, p[0]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[1]),\n\t\t\t\t\t\t\t\tformat_content_for_timeline(p[2]),\n\t\t\t\t\t\t\t\trow[1],\n\t\t\t\t\t\t\t])\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn parts.length < 3;\n\t\t\t});\n\t\t\treturn parts.length < 3;\n\t\t});\n\t\tif (parts.length) {\n\t\t\tlet message = updater_reference_link\n\t\t\t\t? get_user_message(\n\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t__(\"You changed the values for {0} {1}\", [\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t]),\n\t\t\t\t\t\t__(\"{0} changed the values for {1} {2}\", [\n\t\t\t\t\t\t\tget_user_link(version_doc.owner),\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t\tupdater_reference_link,\n\t\t\t\t\t\t])\n\t\t\t\t  )\n\t\t\t\t: get_user_message(\n\t\t\t\t\t\tversion_doc.owner,\n\t\t\t\t\t\t__(\"You changed the values for {0}\", [parts.join(\", \")]),\n\t\t\t\t\t\t__(\"{0} changed the values for {1}\", [\n\t\t\t\t\t\t\tget_user_link(version_doc.owner),\n\t\t\t\t\t\t\tparts.join(\", \"),\n\t\t\t\t\t\t])\n\t\t\t\t  );\n\n\t\t\tout.push(get_version_comment(version_doc, message));\n\t\t}\n\t}\n\n\t// rows added / removed\n\t// __('added'), __('removed') # for translation, don't remove\n\t[\"added\", \"removed\"].forEach(function (key) {\n\t\tif (data[key] && data[key].length) {\n\t\t\tlet parts = (data[key] || []).map(function (p) {\n\t\t\t\tvar df = frappe.meta.get_docfield(frm.doctype, p[0], frm.docname);\n\t\t\t\tif (df && !df.hidden) {\n\t\t\t\t\tvar field_display_status = frappe.perm.get_field_display_status(\n\t\t\t\t\t\tdf,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tfrm.perm\n\t\t\t\t\t);\n\n\t\t\t\t\tif (field_display_status === \"Read\" || field_display_status === \"Write\") {\n\t\t\t\t\t\treturn __(frappe.meta.get_label(frm.doctype, p[0]));\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tparts = parts.filter(function (p) {\n\t\t\t\treturn p;\n\t\t\t});\n\t\t\tif (parts.length) {\n\t\t\t\tlet message = \"\";\n\n\t\t\t\tif (key === \"added\") {\n\t\t\t\t\tmessage = __(\"added rows for {0}\", [parts.join(\", \")]);\n\t\t\t\t} else if (key === \"removed\") {\n\t\t\t\t\tmessage = __(\"removed rows for {0}\", [parts.join(\", \")]);\n\t\t\t\t}\n\n\t\t\t\tlet version_comment = get_version_comment(version_doc, message);\n\t\t\t\tlet user_link = get_user_link(version_doc.owner);\n\t\t\t\tout.push(`${user_link} ${version_comment}`);\n\t\t\t}\n\t\t}\n\t});\n\tconst impersonated_by = data.impersonated_by;\n\n\tif (impersonated_by) {\n\t\tconst impersonated_msg = __(\"Impersonated by {0}\", [get_user_link(impersonated_by)]);\n\t\tout = out.map((message) => `${message} \u00B7 ${impersonated_msg.bold()}`);\n\t}\n\treturn out;\n}\n\nfunction get_version_comment(version_doc, text) {\n\t// TODO: Replace with a better solution\n\tif (text.includes(\"<a\")) {\n\t\t// if text already has linked content in it\n\t\t// then just add a version link to unlinked content\n\t\tlet version_comment = \"\";\n\t\tlet unlinked_content = \"\";\n\n\t\ttry {\n\t\t\ttext += \"</>\";\n\t\t\tArray.from($(text)).forEach((element) => {\n\t\t\t\tif ($(element).is(\"a\")) {\n\t\t\t\t\tversion_comment += unlinked_content\n\t\t\t\t\t\t? frappe.utils.get_form_link(\n\t\t\t\t\t\t\t\t\"Version\",\n\t\t\t\t\t\t\t\tversion_doc.name,\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\tunlinked_content\n\t\t\t\t\t\t  )\n\t\t\t\t\t\t: \"\";\n\t\t\t\t\tunlinked_content = \"\";\n\t\t\t\t\tversion_comment += element.outerHTML;\n\t\t\t\t} else {\n\t\t\t\t\tunlinked_content += element.outerHTML || element.textContent;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (unlinked_content) {\n\t\t\t\tversion_comment += frappe.utils.get_form_link(\n\t\t\t\t\t\"Version\",\n\t\t\t\t\tversion_doc.name,\n\t\t\t\t\ttrue,\n\t\t\t\t\tunlinked_content\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn version_comment;\n\t\t} catch (e) {\n\t\t\t// pass\n\t\t}\n\t}\n\treturn frappe.utils.get_form_link(\"Version\", version_doc.name, true, text);\n}\n\nfunction format_content_for_timeline(content) {\n\t// text to HTML\n\t// limits content to 40 characters\n\t// escapes HTML\n\t// and makes it bold\n\tcontent = frappe.utils.html2text(content);\n\tcontent = frappe.ellipsis(content, 40) || '\"\"';\n\tcontent = frappe.utils.escape_html(content);\n\treturn content.bold();\n}\n\nfunction get_user_link(user) {\n\tconst user_display_text = frappe.user_info(user).fullname || \"\";\n\treturn frappe.utils.get_form_link(\"User\", user, true, user_display_text);\n}\n\nfunction get_user_message(user, message_self, message_other) {\n\treturn frappe.utils.is_current_user(user) ? message_self : message_other;\n}\n\nexport { get_version_timeline_content, get_user_link, get_user_message };\n", "// Copyright (c) 2020, Frappe Technologies Pvt. Ltd. and Contributors\n// MIT License. See license.txt\nimport BaseTimeline from \"./base_timeline\";\nimport {\n\tget_version_timeline_content,\n\tget_user_link,\n\tget_user_message,\n} from \"./version_timeline_content_builder\";\n\nclass FormTimeline extends BaseTimeline {\n\tmake() {\n\t\tsuper.make();\n\t\tthis.setup_timeline_actions();\n\t\tthis.render_timeline_items();\n\t\tthis.setup_activity_toggle();\n\t}\n\n\trefresh() {\n\t\tsuper.refresh();\n\t\tthis.frm.trigger(\"timeline_refresh\");\n\t\tthis.setup_document_email_link();\n\t}\n\n\tsetup_timeline_actions() {\n\t\tthis.add_action_button(\n\t\t\t__(\"New Email\"),\n\t\t\t() => this.compose_mail(),\n\t\t\t\"es-line-add\",\n\t\t\t\"btn-secondary\"\n\t\t);\n\t\tthis.setup_new_event_button();\n\t}\n\n\tsetup_new_event_button() {\n\t\tif (this.frm.meta.allow_events_in_timeline) {\n\t\t\tlet create_event = () => {\n\t\t\t\tconst args = {\n\t\t\t\t\tdoc: this.frm.doc,\n\t\t\t\t\tfrm: this.frm,\n\t\t\t\t\trecipients: this.get_recipient(),\n\t\t\t\t\ttxt: frappe.markdown(this.frm.comment_box.get_value()),\n\t\t\t\t};\n\t\t\t\treturn new frappe.views.InteractionComposer(args);\n\t\t\t};\n\t\t\tthis.add_action_button(__(\"New Event\"), create_event, \"calendar\");\n\t\t}\n\t}\n\n\tsetup_activity_toggle() {\n\t\tlet doc_info = this.doc_info || this.frm.get_docinfo();\n\t\tlet has_communications = () => {\n\t\t\tlet communications = doc_info.communications;\n\t\t\tlet comments = doc_info.comments;\n\t\t\treturn (communications || []).length || (comments || []).length;\n\t\t};\n\t\tlet me = this;\n\t\tthis.timeline_wrapper.remove(this.timeline_actions_wrapper);\n\t\tthis.timeline_wrapper.prepend(`\n\t\t\t\t<div class=\"timeline-item activity-title\">\n\t\t\t\t<h4>${__(\"Activity\")}</h4>\n\t\t\t\t</div>\n\t\t\t`);\n\t\tif (has_communications()) {\n\t\t\tthis.timeline_wrapper\n\t\t\t\t.find(\".timeline-item.activity-title\")\n\t\t\t\t.append(\n\t\t\t\t\t`\n\t\t\t\t\t<div class=\"d-flex align-items-center show-all-activity\">\n\t\t\t\t\t\t<span style=\"color: var(--text-light); margin:0px 6px;\">${__(\"Show all activity\")}</span>\n\t\t\t\t\t\t<label class=\"switch\">\n\t\t\t\t\t\t\t<input type=\"checkbox\">\n\t\t\t\t\t\t\t<span class=\"slider round\"></span>\n\t\t\t\t\t\t</label>\n\t\t\t\t\t</div>\n\t\t\t\t`\n\t\t\t\t)\n\t\t\t\t.find(\"input[type=checkbox]\")\n\t\t\t\t.prop(\"checked\", !me.only_communication)\n\t\t\t\t.on(\"click\", function (e) {\n\t\t\t\t\tme.only_communication = !this.checked;\n\t\t\t\t\tme.render_timeline_items();\n\t\t\t\t\t$(this).tab(\"show\");\n\t\t\t\t});\n\t\t}\n\t\tthis.timeline_wrapper\n\t\t\t.find(\".timeline-item.activity-title\")\n\t\t\t.append(this.timeline_actions_wrapper);\n\t}\n\n\tsetup_document_email_link() {\n\t\tlet doc_info = this.doc_info || this.frm.get_docinfo();\n\n\t\tthis.document_email_link_wrapper && this.document_email_link_wrapper.remove();\n\n\t\tif (doc_info.document_email) {\n\t\t\tconst link = `<a class=\"document-email-link\">${doc_info.document_email}</a>`;\n\t\t\tconst message = __(\"Add to this activity by mailing to {0}\", [link.bold()]);\n\n\t\t\tthis.document_email_link_wrapper = $(`\n\t\t\t\t<div class=\"timeline-item\">\n\t\t\t\t\t<div class=\"timeline-dot\"></div>\n\t\t\t\t\t<div class=\"timeline-content\">\n\t\t\t\t\t\t<span>${message}</span>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t`);\n\t\t\tthis.timeline_items_wrapper.before(this.document_email_link_wrapper);\n\n\t\t\tthis.document_email_link_wrapper.find(\".document-email-link\").on(\"click\", (e) => {\n\t\t\t\tlet text = $(e.target).text();\n\t\t\t\tfrappe.utils.copy_to_clipboard(text);\n\t\t\t});\n\t\t}\n\t}\n\n\trender_timeline_items() {\n\t\tsuper.render_timeline_items();\n\t\tthis.add_web_page_view_count();\n\t\tfrappe.utils.bind_actions_with_object(this.timeline_items_wrapper, this);\n\t}\n\n\tadd_web_page_view_count() {\n\t\tif (this.frm.doc.route && cint(frappe.boot.website_tracking_enabled)) {\n\t\t\tfrappe.utils.get_page_view_count(this.frm.doc.route).then((res) => {\n\t\t\t\tthis.add_timeline_item({\n\t\t\t\t\tcontent: __(\"{0} Web page views\", [res.message]),\n\t\t\t\t\thide_timestamp: true,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tget_creation_message() {\n\t\treturn {\n\t\t\tcreation: this.frm.doc.creation,\n\t\t\tcontent: get_user_message(\n\t\t\t\tthis.frm.doc.owner,\n\t\t\t\t__(\"You created this\"),\n\t\t\t\t__(\"{0} created this\", [get_user_link(this.frm.doc.owner)])\n\t\t\t),\n\t\t};\n\t}\n\n\tget_modified_message() {\n\t\treturn {\n\t\t\tcreation: this.frm.doc.modified,\n\t\t\tcontent: get_user_message(\n\t\t\t\tthis.frm.doc.modified_by,\n\t\t\t\t__(\"You last edited this\"),\n\t\t\t\t__(\"{0} last edited this\", [get_user_link(this.frm.doc.modified_by)])\n\t\t\t),\n\t\t};\n\t}\n\n\tprepare_timeline_contents() {\n\t\tthis.timeline_items.push(this.get_creation_message());\n\t\tthis.timeline_items.push(this.get_modified_message());\n\t\tthis.timeline_items.push(...this.get_communication_timeline_contents());\n\t\tthis.timeline_items.push(...this.get_comment_timeline_contents());\n\t\tif (!this.only_communication) {\n\t\t\tthis.timeline_items.push(...this.get_view_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_energy_point_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_version_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_share_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_workflow_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_like_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_custom_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_assignment_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_attachment_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_info_timeline_contents());\n\t\t\tthis.timeline_items.push(...this.get_milestone_timeline_contents());\n\t\t}\n\t}\n\n\tget_view_timeline_contents() {\n\t\tlet view_timeline_contents = [];\n\t\t(this.doc_info.views || []).forEach((view) => {\n\t\t\tview_timeline_contents.push({\n\t\t\t\tcreation: view.creation,\n\t\t\t\tcontent: get_user_message(\n\t\t\t\t\tview.owner,\n\t\t\t\t\t__(\"You viewed this\"),\n\t\t\t\t\t__(\"{0} viewed this\", [get_user_link(view.owner)])\n\t\t\t\t),\n\t\t\t});\n\t\t});\n\n\t\treturn view_timeline_contents;\n\t}\n\n\tget_communication_timeline_contents(more_communications, more_automated_messages) {\n\t\tlet email_communications =\n\t\t\tthis.get_email_communication_timeline_contents(more_communications);\n\t\tlet automated_messages = this.get_auto_messages_timeline_contents(more_automated_messages);\n\t\tlet all_communications = email_communications.concat(automated_messages);\n\n\t\tif (all_communications.length > 20) {\n\t\t\tall_communications.pop();\n\n\t\t\tif (more_communications || more_automated_messages) {\n\t\t\t\tall_communications.forEach((message) => {\n\t\t\t\t\tif (message.communication_type == \"Automated Message\") {\n\t\t\t\t\t\tthis.doc_info.automated_messages.push(message);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.doc_info.communications.push(message);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tlet last_communication_time =\n\t\t\t\tall_communications[all_communications.length - 1].creation;\n\t\t\tlet load_more_button = {\n\t\t\t\tcreation: last_communication_time,\n\t\t\t\tcontent: __(\"Load More Communications\", null, \"Form timeline\"),\n\t\t\t\tname: \"load-more\",\n\t\t\t};\n\t\t\tall_communications.push(load_more_button);\n\t\t}\n\n\t\treturn all_communications;\n\t}\n\n\tget_email_communication_timeline_contents(more_items) {\n\t\tlet communication_timeline_contents = [];\n\t\tlet icon_set = {\n\t\t\tEmail: \"mail\",\n\t\t\tPhone: \"call\",\n\t\t\tMeeting: \"calendar\",\n\t\t\tOther: \"dot-horizontal\",\n\t\t};\n\t\tlet items = more_items ? more_items : this.doc_info.communications || [];\n\t\titems.forEach((communication) => {\n\t\t\tlet medium = communication.communication_medium;\n\t\t\tcommunication_timeline_contents.push({\n\t\t\t\ticon: icon_set[medium],\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: communication.communication_date,\n\t\t\t\tis_card: true,\n\t\t\t\tcontent: this.get_communication_timeline_content(communication),\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tid: `communication-${communication.name}`,\n\t\t\t\tname: communication.name,\n\t\t\t});\n\t\t});\n\n\t\treturn communication_timeline_contents;\n\t}\n\n\tasync get_more_communication_timeline_contents() {\n\t\tlet more_items = [];\n\t\tlet start =\n\t\t\tthis.doc_info.communications.length + this.doc_info.automated_messages.length - 1;\n\t\tlet response = await frappe.call({\n\t\t\tmethod: \"frappe.desk.form.load.get_communications\",\n\t\t\targs: {\n\t\t\t\tdoctype: this.doc_info.doctype,\n\t\t\t\tname: this.doc_info.name,\n\t\t\t\tstart: start,\n\t\t\t\tlimit: 21,\n\t\t\t},\n\t\t});\n\t\tif (response.message) {\n\t\t\tlet email_communications = [];\n\t\t\tlet automated_messages = [];\n\t\t\tresponse.message.forEach((message) => {\n\t\t\t\tif (message.communication_type == \"Automated Message\") {\n\t\t\t\t\tautomated_messages.push(message);\n\t\t\t\t} else {\n\t\t\t\t\temail_communications.push(message);\n\t\t\t\t}\n\t\t\t});\n\t\t\tmore_items = this.get_communication_timeline_contents(\n\t\t\t\temail_communications,\n\t\t\t\tautomated_messages\n\t\t\t);\n\t\t}\n\t\treturn more_items;\n\t}\n\n\tget_communication_timeline_content(doc, allow_reply = true) {\n\t\tdoc._url = frappe.utils.get_form_link(\"Communication\", doc.name);\n\t\tthis.set_communication_doc_status(doc);\n\t\tif (doc.attachments && typeof doc.attachments === \"string\") {\n\t\t\tdoc.attachments = JSON.parse(doc.attachments);\n\t\t}\n\t\tdoc.owner = doc.sender;\n\t\tdoc.user_full_name = doc.sender_full_name;\n\t\tdoc.content = frappe.dom.remove_script_and_style(doc.content);\n\t\tlet communication_content = $(frappe.render_template(\"timeline_message_box\", { doc }));\n\t\tif (allow_reply) {\n\t\t\tthis.setup_reply(communication_content, doc);\n\t\t}\n\t\treturn communication_content;\n\t}\n\n\tset_communication_doc_status(doc) {\n\t\tlet indicator_color = \"red\";\n\t\tif ([\"Sent\", \"Clicked\"].includes(doc.delivery_status)) {\n\t\t\tindicator_color = \"green\";\n\t\t} else if ([\"Sending\", \"Scheduled\"].includes(doc.delivery_status)) {\n\t\t\tindicator_color = \"orange\";\n\t\t} else if ([\"Opened\", \"Read\"].includes(doc.delivery_status)) {\n\t\t\tindicator_color = \"blue\";\n\t\t} else if (doc.delivery_status == \"Error\") {\n\t\t\tindicator_color = \"red\";\n\t\t}\n\t\tdoc._doc_status = doc.delivery_status;\n\t\tdoc._doc_status_indicator = indicator_color;\n\t}\n\n\tget_auto_messages_timeline_contents(more_items) {\n\t\tlet auto_messages_timeline_contents = [];\n\t\tlet items = more_items ? more_items : this.doc_info.automated_messages || [];\n\t\titems.forEach((message) => {\n\t\t\tauto_messages_timeline_contents.push({\n\t\t\t\ticon: \"notification\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: message.creation,\n\t\t\t\tis_card: true,\n\t\t\t\tcontent: this.get_communication_timeline_content(message, false),\n\t\t\t\tdoctype: \"Communication\",\n\t\t\t\tname: message.name,\n\t\t\t});\n\t\t});\n\t\treturn auto_messages_timeline_contents;\n\t}\n\n\tget_comment_timeline_contents() {\n\t\tlet comment_timeline_contents = [];\n\t\t(this.doc_info.comments || []).forEach((comment) => {\n\t\t\tcomment_timeline_contents.push(this.get_comment_timeline_item(comment));\n\t\t});\n\t\treturn comment_timeline_contents;\n\t}\n\n\tget_comment_timeline_item(comment) {\n\t\treturn {\n\t\t\ticon: \"es-line-chat-alt\",\n\t\t\ticon_size: \"sm\",\n\t\t\tcreation: comment.creation,\n\t\t\tis_card: true,\n\t\t\tdoctype: \"Comment\",\n\t\t\tid: `comment-${comment.name}`,\n\t\t\tname: comment.name,\n\t\t\tcontent: this.get_comment_timeline_content(comment),\n\t\t};\n\t}\n\n\tget_comment_timeline_content(doc) {\n\t\tdoc.content = frappe.dom.remove_script_and_style(doc.content);\n\t\tconst comment_content = $(frappe.render_template(\"timeline_message_box\", { doc }));\n\t\tthis.setup_comment_actions(comment_content, doc);\n\t\treturn comment_content;\n\t}\n\n\tget_version_timeline_contents() {\n\t\tlet version_timeline_contents = [];\n\t\t(this.doc_info.versions || []).forEach((version) => {\n\t\t\tconst contents = get_version_timeline_content(version, this.frm);\n\t\t\tcontents.forEach((content) => {\n\t\t\t\tversion_timeline_contents.push({\n\t\t\t\t\tcreation: version.creation,\n\t\t\t\t\tcontent: content,\n\t\t\t\t});\n\t\t\t});\n\t\t});\n\t\treturn version_timeline_contents;\n\t}\n\n\tget_share_timeline_contents() {\n\t\tlet share_timeline_contents = [];\n\t\t(this.doc_info.share_logs || []).forEach((share_log) => {\n\t\t\tshare_timeline_contents.push({\n\t\t\t\tcreation: share_log.creation,\n\t\t\t\tcontent: share_log.content,\n\t\t\t});\n\t\t});\n\t\treturn share_timeline_contents;\n\t}\n\n\tget_assignment_timeline_contents() {\n\t\tlet assignment_timeline_contents = [];\n\t\t(this.doc_info.assignment_logs || []).forEach((assignment_log) => {\n\t\t\tassignment_timeline_contents.push({\n\t\t\t\tcreation: assignment_log.creation,\n\t\t\t\tcontent: assignment_log.content,\n\t\t\t});\n\t\t});\n\t\treturn assignment_timeline_contents;\n\t}\n\n\tget_info_timeline_contents() {\n\t\tlet info_timeline_contents = [];\n\t\t(this.doc_info.info_logs || []).forEach((info_log) => {\n\t\t\tinfo_timeline_contents.push({\n\t\t\t\tcreation: info_log.creation,\n\t\t\t\tcontent: `${get_user_link(info_log.owner)} ${info_log.content}`,\n\t\t\t});\n\t\t});\n\t\treturn info_timeline_contents;\n\t}\n\n\tget_attachment_timeline_contents() {\n\t\tlet attachment_timeline_contents = [];\n\n\t\t(this.doc_info.attachment_logs || []).forEach((attachment_log) => {\n\t\t\tconst is_file_upload = attachment_log.comment_type == \"Attachment\";\n\t\t\tconst user_link = get_user_link(attachment_log.owner);\n\t\t\tconst filename = attachment_log.content;\n\t\t\tconst timeline_content = is_file_upload\n\t\t\t\t? get_user_message(\n\t\t\t\t\t\tattachment_log.owner,\n\t\t\t\t\t\t__(\"You attached {0}\", [filename], \"Form timeline\"),\n\t\t\t\t\t\t__(\"{0} attached {1}\", [user_link, filename], \"Form timeline\")\n\t\t\t\t  )\n\t\t\t\t: get_user_message(\n\t\t\t\t\t\tattachment_log.owner,\n\t\t\t\t\t\t__(\"You removed attachment {0}\", [filename], \"Form timeline\"),\n\t\t\t\t\t\t__(\"{0} removed attachment {1}\", [user_link, filename], \"Form timeline\")\n\t\t\t\t  );\n\n\t\t\tattachment_timeline_contents.push({\n\t\t\t\ticon: is_file_upload ? \"es-line-attachment\" : \"es-line-delete\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: attachment_log.creation,\n\t\t\t\tcontent: timeline_content,\n\t\t\t});\n\t\t});\n\n\t\treturn attachment_timeline_contents;\n\t}\n\n\tget_milestone_timeline_contents() {\n\t\tlet milestone_timeline_contents = [];\n\n\t\t(this.doc_info.milestones || []).forEach((milestone_log) => {\n\t\t\tconst field = frappe.meta.get_label(this.frm.doctype, milestone_log.track_field);\n\t\t\tconst value = milestone_log.value.bold();\n\t\t\tconst user_link = get_user_link(milestone_log.owner);\n\t\t\tconst timeline_content = get_user_message(\n\t\t\t\tmilestone_log.owner,\n\t\t\t\t__(\"You changed {0} to {1}\", [field, value], \"Form timeline\"),\n\t\t\t\t__(\"{0} changed {1} to {2}\", [user_link, field, value], \"Form timeline\")\n\t\t\t);\n\n\t\t\tmilestone_timeline_contents.push({\n\t\t\t\ticon: \"milestone\",\n\t\t\t\tcreation: milestone_log.creation,\n\t\t\t\tcontent: timeline_content,\n\t\t\t});\n\t\t});\n\n\t\treturn milestone_timeline_contents;\n\t}\n\n\tget_like_timeline_contents() {\n\t\tlet like_timeline_contents = [];\n\n\t\t(this.doc_info.like_logs || []).forEach((like_log) => {\n\t\t\tconst timeline_content = get_user_message(\n\t\t\t\tlike_log.owner,\n\t\t\t\t__(\"You Liked\"),\n\t\t\t\t__(\"{0} Liked\", [get_user_link(like_log.owner)])\n\t\t\t);\n\n\t\t\tlike_timeline_contents.push({\n\t\t\t\ticon: \"es-line-like\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: like_log.creation,\n\t\t\t\tcontent: timeline_content,\n\t\t\t\ttitle: \"Like\",\n\t\t\t});\n\t\t});\n\n\t\treturn like_timeline_contents;\n\t}\n\n\tget_workflow_timeline_contents() {\n\t\tlet workflow_timeline_contents = [];\n\t\t(this.doc_info.workflow_logs || []).forEach((workflow_log) => {\n\t\t\tworkflow_timeline_contents.push({\n\t\t\t\ticon: \"branch\",\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tcreation: workflow_log.creation,\n\t\t\t\tcontent: `${get_user_link(workflow_log.owner)} ${__(workflow_log.content)}`,\n\t\t\t\ttitle: \"Workflow\",\n\t\t\t});\n\t\t});\n\t\treturn workflow_timeline_contents;\n\t}\n\n\tget_custom_timeline_contents() {\n\t\tlet custom_timeline_contents = [];\n\t\t(this.doc_info.additional_timeline_content || []).forEach((custom_item) => {\n\t\t\tcustom_timeline_contents.push({\n\t\t\t\ticon: custom_item.icon,\n\t\t\t\ticon_size: \"sm\",\n\t\t\t\tis_card: custom_item.is_card,\n\t\t\t\tcreation: custom_item.creation,\n\t\t\t\tcontent:\n\t\t\t\t\tcustom_item.content ||\n\t\t\t\t\tfrappe.render_template(custom_item.template, custom_item.template_data),\n\t\t\t});\n\t\t});\n\t\treturn custom_timeline_contents;\n\t}\n\n\tget_energy_point_timeline_contents() {\n\t\tlet energy_point_timeline_contents = [];\n\t\t(this.doc_info.energy_point_logs || []).forEach((log) => {\n\t\t\tlet timeline_badge = `\n\t\t\t<div class=\"timeline-badge ${log.points > 0 ? \"appreciation\" : \"criticism\"} bold\">\n\t\t\t\t${log.points}\n\t\t\t</div>`;\n\n\t\t\tenergy_point_timeline_contents.push({\n\t\t\t\ttimeline_badge: timeline_badge,\n\t\t\t\tcreation: log.creation,\n\t\t\t\tcontent: frappe.energy_points.format_form_log(log),\n\t\t\t});\n\t\t});\n\t\treturn energy_point_timeline_contents;\n\t}\n\n\tsetup_reply(communication_box, communication_doc) {\n\t\tlet actions = communication_box.find(\".custom-actions\");\n\t\tlet reply = $(`<a class=\"action-btn reply\">${frappe.utils.icon(\"reply\", \"md\")}</a>`).click(\n\t\t\t() => {\n\t\t\t\tthis.compose_mail(communication_doc);\n\t\t\t}\n\t\t);\n\t\tlet reply_all = $(\n\t\t\t`<a class=\"action-btn reply-all\">${frappe.utils.icon(\"reply-all\", \"md\")}</a>`\n\t\t).click(() => {\n\t\t\tthis.compose_mail(communication_doc, true);\n\t\t});\n\t\tactions.append(reply);\n\t\tactions.append(reply_all);\n\t}\n\n\tcompose_mail(communication_doc = null, reply_all = false) {\n\t\tconst args = {\n\t\t\tdoc: this.frm.doc,\n\t\t\tfrm: this.frm,\n\t\t\trecipients:\n\t\t\t\tcommunication_doc && communication_doc.sender != frappe.session.user_email\n\t\t\t\t\t? communication_doc.sender\n\t\t\t\t\t: this.get_recipient(),\n\t\t\tis_a_reply: Boolean(communication_doc),\n\t\t\ttitle: communication_doc ? __(\"Reply\") : null,\n\t\t\tlast_email: communication_doc,\n\t\t\tsubject: communication_doc && communication_doc.subject,\n\t\t\treply_all: reply_all,\n\t\t};\n\n\t\tconst email_accounts = frappe.boot.email_accounts\n\t\t\t.filter((account) => {\n\t\t\t\treturn (\n\t\t\t\t\t![\"All Accounts\", \"Sent\", \"Spam\", \"Trash\"].includes(account.email_account) &&\n\t\t\t\t\taccount.enable_outgoing\n\t\t\t\t);\n\t\t\t})\n\t\t\t.map((e) => e.email_id);\n\n\t\tif (communication_doc && args.is_a_reply) {\n\t\t\targs.cc = \"\";\n\t\t\tif (\n\t\t\t\temail_accounts.includes(frappe.session.user_email) &&\n\t\t\t\tcommunication_doc.sender != frappe.session.user_email\n\t\t\t) {\n\t\t\t\t// add recipients to cc if replying sender is different from last email\n\t\t\t\tconst recipients = communication_doc.recipients.split(\",\").map((r) => r.trim());\n\t\t\t\targs.cc =\n\t\t\t\t\trecipients.filter((r) => r != frappe.session.user_email).join(\", \") + \", \";\n\t\t\t}\n\t\t\tif (reply_all) {\n\t\t\t\t// if reply_all then add cc and bcc as well.\n\t\t\t\targs.cc += cstr(communication_doc.cc);\n\t\t\t\targs.bcc = cstr(communication_doc.bcc);\n\t\t\t}\n\t\t}\n\n\t\tif (this.frm.doctype === \"Communication\") {\n\t\t\targs.message = \"\";\n\t\t\targs.last_email = this.frm.doc;\n\t\t\targs.recipients = this.frm.doc.sender;\n\t\t\targs.subject = __(\"Re: {0}\", [this.frm.doc.subject]);\n\t\t} else {\n\t\t\tconst comment_value = frappe.markdown(this.frm.comment_box.get_value());\n\t\t\targs.message = strip_html(comment_value) ? comment_value : \"\";\n\t\t}\n\n\t\tnew frappe.views.CommunicationComposer(args);\n\t}\n\n\tget_recipient() {\n\t\tif (this.frm.email_field) {\n\t\t\treturn this.frm.doc[this.frm.email_field];\n\t\t} else {\n\t\t\treturn this.frm.doc.email_id || this.frm.doc.email || \"\";\n\t\t}\n\t}\n\n\tsetup_comment_actions(comment_wrapper, doc) {\n\t\tlet edit_wrapper = $(`<div class=\"comment-edit-box\">`).hide();\n\t\tlet edit_box = this.make_editable(edit_wrapper);\n\t\tlet content_wrapper = comment_wrapper.find(\".content\");\n\t\tlet more_actions_wrapper = comment_wrapper.find(\".more-actions\");\n\t\tif (\n\t\t\tfrappe.model.can_delete(\"Comment\") &&\n\t\t\t(frappe.session.user == doc.owner || frappe.user.has_role(\"System Manager\"))\n\t\t) {\n\t\t\tconst delete_option = $(`\n\t\t\t\t<li>\n\t\t\t\t\t<a class=\"dropdown-item\">\n\t\t\t\t\t\t${__(\"Delete\")}\n\t\t\t\t\t</a>\n\t\t\t\t</li>\n\t\t\t`).click(() => this.delete_comment(doc.name));\n\t\t\tmore_actions_wrapper.find(\".dropdown-menu\").append(delete_option);\n\t\t}\n\n\t\tlet dismiss_button = $(`\n\t\t\t<button class=\"btn btn-link action-btn\">\n\t\t\t\t${__(\"Dismiss\")}\n\t\t\t</button>\n\t\t`).click(() => edit_button.toggle_edit_mode());\n\t\tdismiss_button.hide();\n\n\t\tedit_box.set_value(doc.content);\n\n\t\tedit_box.on_submit = (value) => {\n\t\t\tcontent_wrapper.empty();\n\t\t\tcontent_wrapper.append(value);\n\t\t\tedit_button.prop(\"disabled\", true);\n\t\t\tedit_box.quill.enable(false);\n\n\t\t\tdoc.content = value;\n\t\t\tthis.update_comment(doc.name, value)\n\t\t\t\t.then(edit_button.toggle_edit_mode)\n\t\t\t\t.finally(() => {\n\t\t\t\t\tedit_button.prop(\"disabled\", false);\n\t\t\t\t\tedit_box.quill.enable(true);\n\t\t\t\t});\n\t\t};\n\n\t\tcontent_wrapper.after(edit_wrapper);\n\n\t\tlet edit_button = $();\n\t\tlet current_user = frappe.session.user;\n\t\tif ([\"Administrator\", doc.owner].includes(current_user)) {\n\t\t\tedit_button = $(`<button class=\"btn btn-link action-btn\">${__(\"Edit\")}</a>`).click(\n\t\t\t\t() => {\n\t\t\t\t\tedit_button.edit_mode ? edit_box.submit() : edit_button.toggle_edit_mode();\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\tedit_button.toggle_edit_mode = () => {\n\t\t\tedit_button.edit_mode = !edit_button.edit_mode;\n\t\t\tedit_button.text(edit_button.edit_mode ? __(\"Save\") : __(\"Edit\"));\n\t\t\tmore_actions_wrapper.toggle(!edit_button.edit_mode);\n\t\t\tdismiss_button.toggle(edit_button.edit_mode);\n\t\t\tedit_wrapper.toggle(edit_button.edit_mode);\n\t\t\tcontent_wrapper.toggle(!edit_button.edit_mode);\n\t\t};\n\t\tlet actions_wrapper = comment_wrapper.find(\".custom-actions\");\n\t\tactions_wrapper.append(edit_button);\n\t\tactions_wrapper.append(dismiss_button);\n\t}\n\n\tmake_editable(container) {\n\t\treturn frappe.ui.form.make_control({\n\t\t\tparent: container,\n\t\t\tdf: {\n\t\t\t\tfieldtype: \"Comment\",\n\t\t\t\tfieldname: \"comment\",\n\t\t\t\tlabel: \"Comment\",\n\t\t\t},\n\t\t\tenable_mentions: true,\n\t\t\trender_input: true,\n\t\t\tonly_input: true,\n\t\t\tno_wrapper: true,\n\t\t});\n\t}\n\n\tupdate_comment(name, content) {\n\t\treturn frappe\n\t\t\t.xcall(\"frappe.desk.form.utils.update_comment\", { name, content })\n\t\t\t.then(() => {\n\t\t\t\tfrappe.utils.play_sound(\"click\");\n\t\t\t});\n\t}\n\n\tget_last_email(from_recipient) {\n\t\t/**\n\t\t * Return the latest email communication.\n\t\t *\n\t\t * @param {boolean} from_recipient If true, only considers emails where current form's recipient is the sender.\n\t\t * @returns {object|null} The latest email communication, or null if no communication is found.\n\t\t */\n\n\t\tconst communications = this.frm.get_docinfo().communications || [];\n\t\tconst recipient = this.get_recipient();\n\n\t\tconst filtered_records = communications\n\t\t\t.filter(\n\t\t\t\t(record) =>\n\t\t\t\t\trecord.communication_type === \"Communication\" &&\n\t\t\t\t\trecord.communication_medium === \"Email\" &&\n\t\t\t\t\t(!from_recipient || record.sender === recipient)\n\t\t\t)\n\t\t\t.sort((a, b) => b.creation - a.creation);\n\n\t\treturn filtered_records[0] || null;\n\t}\n\n\tdelete_comment(comment_name) {\n\t\tfrappe.confirm(__(\"Delete comment?\"), () => {\n\t\t\treturn frappe\n\t\t\t\t.xcall(\"frappe.client.delete\", {\n\t\t\t\t\tdoctype: \"Comment\",\n\t\t\t\t\tname: comment_name,\n\t\t\t\t})\n\t\t\t\t.then(() => {\n\t\t\t\t\tfrappe.utils.play_sound(\"delete\");\n\t\t\t\t});\n\t\t});\n\t}\n\n\tcopy_link(ev) {\n\t\tlet doc_link = frappe.urllib.get_full_url(\n\t\t\tfrappe.utils.get_form_link(this.frm.doctype, this.frm.docname)\n\t\t);\n\t\tlet element_id = $(ev.currentTarget).closest(\".timeline-content\").attr(\"id\");\n\t\tfrappe.utils.copy_to_clipboard(`${doc_link}#${element_id}`);\n\t}\n}\n\nexport default FormTimeline;\n", "//import classes from frappe that are not added to the frappe object\nimport FormTimeline from \"../../../../frappe/frappe/public/js/frappe/form/footer/form_timeline\"\n\n\nwindow.frappe_import = window.frappe_import || {};\n\nwindow.frappe_import['FormTimeline'] = FormTimeline;"],
  "mappings": "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",
  "names": ["parts"]
}
